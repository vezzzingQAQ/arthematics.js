<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>arthematics editor</title>
    <link rel="stylesheet" type="text/css" href="main.css">
    <!--codeMirror高亮-->
    <script src="libs/codeMirror/codemirror.js"></script>
    <link rel="stylesheet" type="text/css" href="libs/codeMirror/codemirror.css">
    <link rel="stylesheet" type="text/css" href="libs/codeMirror/theme/dracula.css">
    <script src="libs/codeMirror/mode/javascript.js"></script>
    <!--arthematics.js-->
    <script src="../arthematics.js"></script>
    <!--储存对象-->
    <script src="store/store.js"></script>
    <script>
        var runningCode;
        window.onload=function(){
            //实现高亮
            var editor = CodeMirror.fromTextArea(document.getElementById("cmcode"),{
                mode:"text/javascript",
                //lineNumbers:true,
                theme:"dracula",
                scrollbarStyle:"null",
                matchBrackets: true,
            });
            editor.setSize(document.querySelector(".codeDiv").offsetWidth+"px",document.querySelector(".codeDiv").offsetHeight+"px");
            //加载储存对象
            var codeList=stroge.displayList;
            var displayCode=codeList[stroge.displayIndex];
            //默认范例加载到editor
            editor.setValue(displayCode.code);
            //读取所有的项目显示到项目列表
            let projectContainer=document.querySelector(".exampleDiv>ul");
            for(let i=0;i<codeList.length;i++){
                projectContainer.innerHTML+=`
                <li id="${codeList[i].name}" class="exampleButton">
                <span class="name">${codeList[i].name}</span>
                <span class="author">by ${codeList[i].author}</span>
                </li>
                `
            }
            //点击项目列表切换显示的项目
            projectContainer.onclick=function(e){
                if(e.target.className=="exampleButton"){
                    let projectName=e.target.id;
                    for(let i=0;i<codeList.length;i++){
                        if(projectName==codeList[i].name){
                            editor.setValue(codeList[i].code);
                            render();
                            break;
                        }
                    }
                }
            }
            //实时预览
            runningCode=editor.getValue();
            eval(runningCode);
            //实现实时预览
            function render(){
                editor.save();
                runningCode=editor.getValue();
                let currentOpDiv=document.querySelector(".displayDiv");
                for(let i=0;i<currentOpDiv.childNodes.length;i++){
                    currentOpDiv.removeChild(currentOpDiv.childNodes[i]);
                }
                reload();
                try{
                    eval(runningCode);
                }catch{

                }
            }
            //按键抬起自动更新
            document.querySelector(".codeDiv").onkeyup=function(){
                render();
            }
        }
    </script>
</head>
<body>
    <div class="infoDiv">
        <p class="name"></p>
        <p class="author"></p>
        <p class="date"></p>
        <div class="img"></div>
    </div>
    <div class="codeDiv">
        <textarea class="codePlace" id="cmcode">

        </textarea>
    </div>
    <div class="displayDiv">

    </div>
    <div class="exampleDiv">
        <ul>
        </ul>
    </div>
</body>
</html>